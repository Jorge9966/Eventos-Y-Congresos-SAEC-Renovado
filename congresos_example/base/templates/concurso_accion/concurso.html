<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Concurso - SAEC</title>
  {% load static %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  {% include '_congreso_base_styles.html' %}
  <style>
    .page-header-card{ background:#fff; border:1px solid #e6ebf2; border-radius:12px; box-shadow:0 10px 28px rgba(15,23,42,0.06); padding:22px 24px; margin-bottom:16px; }
    .page-title{ margin:0; font-size:1.8rem; font-weight:700; color:#0b1730; }
    .form-card{ background:#fff; border:1px solid #e6ebf2; border-radius:12px; box-shadow:0 10px 28px rgba(15,23,42,0.06); padding:18px; }
    .form-label{ font-weight:600; color:#0b1730; display:block; margin-bottom:.375rem; }
    .form-hint{ color:#64748b; font-size:.9rem; margin-top:6px; }
    .type-band{ padding:6px 0 2px; }
    .type-title{ text-align:center; font-weight:900; font-size:1.5rem; color:#0b1730; margin:4px 0 10px; letter-spacing:.2px; }
    .type-title .accent{ border-bottom:4px solid #f97316; padding-bottom:3px; border-radius:2px; }
    .type-picker{ display:flex; gap:18px; flex-wrap:wrap; justify-content:center; margin-bottom:12px; }
    .type-option{ position:relative; border:2px solid #e6ebf2; border-radius:14px; overflow:hidden; cursor:pointer; transition:transform .15s, box-shadow .15s, border-color .15s; }
    .type-option img{ width:320px; height:180px; object-fit:cover; display:block; }
    .type-option span{ position:absolute; left:10px; bottom:8px; background:rgba(0,0,0,.6); color:#fff; padding:4px 10px; border-radius:10px; font-size:.9rem; }
    .type-input{ display:none; }
    .type-input:checked + label{ border-color:#0d6efd; box-shadow:0 10px 22px rgba(13,110,253,.18); }
    .hidden{ display:none !important; }
  </style>
</head>
<body>
  {% include 'partials/congreso_sidebar.html' %}
  <div class="main">
    {% include 'partials/congreso_topbar.html' %}

    <div class="page-header-card">
      <h1 class="page-title">Agregar Concurso</h1>
    </div>

    <div class="container-fluid px-0">
      <div class="type-band">
        <div class="type-title"><span class="accent">Tipo de concurso</span></div>
        <div class="type-picker">
          <input class="type-input" type="radio" name="tipo" id="tipo_ind" value="individual" checked form="concurso-form">
          <label class="type-option" for="tipo_ind">
            <img src="{% static 'base/img/concurso_individual.jpg' %}" alt="Concurso individual" />
            <span>Individual</span>
          </label>
          <input class="type-input" type="radio" name="tipo" id="tipo_grp" value="grupal" form="concurso-form">
          <label class="type-option" for="tipo_grp">
            <img src="{% static 'base/img/concurso_grupal.jpg' %}" alt="Concurso grupal" />
            <span>Grupal</span>
          </label>
        </div>
      </div>

      <form id="concurso-form" class="form-card" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {# Solo mostrar errores/informativos aquí; los éxitos se muestran en la lista #}
        {% if messages %}
          {% for m in messages %}
            {% if 'error' in m.tags or 'warning' in m.tags or 'info' in m.tags %}
              <div class="alert alert-{% if 'error' in m.tags %}danger{% elif 'warning' in m.tags %}warning{% else %}info{% endif %}">{{ m }}</div>
            {% endif %}
          {% endfor %}
        {% endif %}


        <div class="mb-3">
          <label class="form-label" for="image">Imagen (3MB Máximo)</label>
          <input type="file" id="image" name="image" accept="image/*" />
          <div class="form-hint">Opcional. Tamaño máximo 3MB.</div>
        </div>
        <div class="mb-3">
          <label class="form-label">Nombre del Concurso</label>
          <input class="form-control" type="text" name="title" placeholder="Título" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Lugar</label>
          <input class="form-control" type="text" name="lugar" placeholder="Lugar" />
        </div>
        <div class="mb-3">
          <label class="form-label">Instructor</label>
          <select class="form-select" name="instructor_id">
            <option value="">-- Selecciona --</option>
            {% for u in instructors %}
              <option value="{{ u.id }}">{{ u.first_name|default:u.username }} ({{ u.username }})</option>
            {% endfor %}
          </select>
        </div>

        <div id="fields_individual" class="mb-3">
          <label class="form-label">Cupo máximo</label>
          <input class="form-control" type="number" min="0" name="cupo" placeholder="Ej. 50" />
        </div>

        <div id="fields_grupal" class="row g-3 hidden">
          <div class="col-12 col-md-6">
            <label class="form-label">Número de equipos</label>
            <input class="form-control" type="number" min="0" name="numero_equipos" placeholder="Ej. 10" />
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Número máximo de participantes por equipo</label>
            <input class="form-control" type="number" min="0" name="max_por_equipo" placeholder="Ej. 5" />
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Descripción</label>
          <textarea class="form-control" name="descripcion" id="descripcion" rows="8"></textarea>
        </div>
        <div class="d-flex gap-2">
          <a class="btn btn-light" href="{% url 'concursos_list' congreso.id %}">Cancelar</a>
          <button class="btn btn-primary" type="submit">Guardar Concurso</button>
        </div>
      </form>
    </div>
    {% include 'partials/footer.html' %}
  </div>
  <script src="https://cdn.ckeditor.com/4.22.1/standard-all/ckeditor.js"></script>
  <script>
    (function(){
      function sync(){
        var ind = document.getElementById('tipo_ind');
        var g = document.getElementById('tipo_grp');
        var fInd = document.getElementById('fields_individual');
        var fG = document.getElementById('fields_grupal');
        if(ind && fInd && fG){
          var isInd = ind.checked;
          fInd.classList.toggle('hidden', !isInd);
          fG.classList.toggle('hidden', isInd);
        }
      }
      var radios = document.querySelectorAll('input[name="tipo"]');
      radios.forEach(function(r){ r.addEventListener('change', sync); });
      sync();
      if (window.CKEDITOR) { CKEDITOR.replace('descripcion', {height: 260}); }
    })();
  </script>
</body>
</html>
