<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Inicio del congreso - SAEC</title>
  {% load static extra_filters %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { margin:0; display:flex; height:100vh; font-family:'Inter', Arial, Helvetica, sans-serif; background:#eef3fa; overflow:hidden; }
    .sidebar { width:260px; flex:0 0 260px; background:#fff; color:#0f172a; display:flex; flex-direction:column; padding:22px 20px; border-right:1px solid #e6ebf2; position:relative; }
    .sidebar-top { display:flex; align-items:center; justify-content:space-between; padding:4px 2px 14px 2px; }
    .sidebar-top .brand { font-size:1.15rem; font-weight:700; letter-spacing:.5px; color:#0b1730; }
    .sidebar-divider { height:1px; background:#e9eef5; margin:0 -20px 14px; box-shadow:0 1px 0 rgba(15,23,42,0.03); }
    .sidebar .section { margin-top:22px; font-size:0.78rem; color:#94a3b8; letter-spacing:.06em; text-transform:uppercase; }
  .sidebar a, .sidebar .nav-item { display:flex; align-items:center; gap:10px; padding:10px 10px; color:#334155; text-decoration:none; border-radius:10px; transition: background .12s ease, color .12s ease, box-shadow .12s ease; cursor:default; }
  .sidebar a .bi, .sidebar .nav-item .bi{ font-size:1.05rem; color:#64748b; }
  .sidebar a:hover, .sidebar .nav-item:hover { color:#0b5ed7; background:#eef5ff; box-shadow: inset 0 2px 8px rgba(37,99,235,0.12), 0 1px 6px rgba(37,99,235,0.08); }
  .sidebar a.active, .sidebar .nav-item.active{ background:#eaf2ff; color:#2563eb; font-weight:600; }

  .main { flex:1; background:#f6f9ff; padding:0 40px 40px 40px; position:relative; height:100vh; overflow:auto; -webkit-overflow-scrolling: touch; }
  /* Sombra vertical suave junto al sidebar para dar profundidad */
  .main::before {
    content: "";
    position: absolute; top:0; left:0; bottom:0; width:26px;
    background: linear-gradient(to right, rgba(15,23,42,0.10) 0%, rgba(15,23,42,0.06) 35%, rgba(15,23,42,0.00) 100%);
    pointer-events:none;
  }
  /* Transición al colapsar */
  .sidebar{ transition: flex-basis .22s ease, width .22s ease, padding .22s ease, border-right .22s ease; }
  body.sidebar-collapsed .sidebar{ flex-basis:0; width:0; min-width:0; padding:0; border-right:none; overflow:hidden; }
  body.sidebar-collapsed .main::before{ width:0; }

  /* Top bar con misma estética que 'inicio' */
  .topbar { position: sticky; top: 0; z-index: 5; display:flex; align-items:center; justify-content:space-between; background:#ffffff; padding:8px 20px; border-bottom:1px solid #e6ebf2; min-height: 52px; margin-left: -40px; margin-right: -40px; width: calc(100% + 80px); box-shadow: 0 10px 18px -14px rgba(15,23,42,0.22); }
  .topbar::after{ content:""; position:absolute; left:0; right:0; bottom:-12px; height:12px; background: linear-gradient(to bottom, rgba(15,23,42,0.08), rgba(15,23,42,0.00)); pointer-events:none; }
  .topbar::before{ content:""; position:absolute; left:0; top:0; bottom:0; width:26px; background: linear-gradient(to right, rgba(15,23,42,0.10) 0%, rgba(15,23,42,0.06) 35%, rgba(15,23,42,0.00) 100%); pointer-events:none; }
  .topbar-left{ display:flex; align-items:center; gap:16px; }
  .icon-btn{ display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:999px; border:1px solid #e6ebf2; background:#fff; color:#64748b; cursor:pointer; box-shadow: 0 1px 2px rgba(16,24,40,.05); transition: background .12s ease, box-shadow .12s ease, color .12s ease; }
  .icon-btn:hover{ background:#f7fafc; color:#0f172a; box-shadow: 0 2px 6px rgba(16,24,40,.08); }
  .icon-btn svg{ width:18px; height:18px; }
  .topbar-left .icon-btn{ margin-left:-10px; }
  .icon-btn.user{ width:44px; height:44px; }
  .icon-btn.user svg{ width:24px; height:24px; }

  /* Menú de usuario */
  .user-menu{ position:fixed; top:64px; right:24px; width:280px; background:#ffffff; border:1px solid #e6ebf2; border-radius:12px; box-shadow: 0 18px 44px rgba(15,23,42,0.18); display:none; z-index:50; overflow:hidden; }
  .user-menu.open{ display:block; }
  .user-menu .um-header{ display:flex; align-items:center; gap:12px; padding:12px 16px; font-weight:700; color:#0b1730; background:#f8fafc; border-bottom:1px solid #e6ebf2; }
  .user-menu .um-header .avatar{ width:34px; height:34px; display:inline-flex; align-items:center; justify-content:center; border-radius:999px; border:1px solid #e6ebf2; color:#64748b; }
  .user-menu .um-list a{ display:flex; align-items:center; gap:10px; padding:12px 16px; color:#334155; text-decoration:none; background:#fff; }
  .user-menu .um-list a:hover{ background:#eef5ff; color:#0b5ed7; }
  .user-menu .um-list a .bi{ color:#64748b; }

    .hero { margin:24px 0; }
    .hero h1{ font-family:'Poppins','Inter',Arial,Helvetica,sans-serif; font-weight:600; color:#0b1730; }

    .welcome-card{ background:#d9e6ff; border:1px solid #cfe0ff; border-radius:16px; padding:24px; display:flex; align-items:center; justify-content:space-between; gap:20px; }
    .wc-left{ max-width:720px; }
    .wc-title{ font-size:1.6rem; color:#1158c7; font-weight:800; margin-bottom:8px; }
    .wc-quote{ color:#0f172a; opacity:.8; }
    .wc-action.btn-green{ background:#28a745; color:#fff; border:none; padding:10px 20px; border-radius:8px; box-shadow: 0 6px 14px rgba(40,167,69,.22); }
  .wc-right{ flex:1; display:flex; align-items:center; justify-content:center; }
  /* Espaciador para mantener el layout cuando no hay logo */
  .wc-spacer{ width:280px; height:180px; }
  .wc-logo{ width:280px; height:180px; display:flex; align-items:center; justify-content:center; }
  .wc-logo img{ max-width:100%; max-height:100%; object-fit:contain; display:block; }

    .panel{ background:#fff; border:1px solid #e6ebf2; border-radius:12px; box-shadow: 0 10px 28px rgba(15,23,42,0.06); margin-top:24px; }
    .panel .panel-header{ padding:14px 18px; font-weight:700; color:#0b1730; border-bottom:1px solid #e6ebf2; }
    .panel .panel-body{ padding:16px 18px; }
    .empty{ color:#64748b; }
  /* Submenús del sidebar (desplegables con animación) */
  .link-toggle{ cursor:pointer; }
  .link-toggle .chev{ margin-left:auto; color:#94a3b8; transition: transform .18s ease; }
  .link-toggle.open .chev{ transform: rotate(90deg); }
  .submenu{ margin-left:12px; padding-left:12px; border-left:1px solid #e6ebf2; max-height:0; overflow:hidden; opacity:0; transition: max-height .28s ease, opacity .20s ease; }
  .submenu.open{ max-height:600px; opacity:1; }
  .submenu .nav-item{ transition: transform .18s ease, opacity .18s ease; transform: translateY(-4px); opacity:.0; }
  .submenu.open .nav-item{ transform: translateY(0); opacity:1; }
  /* Controles de tabla (estilo similar a 'correos') */
  .table-controls{ display:flex; align-items:center; justify-content:space-between; gap:16px; padding:12px 16px; border-bottom:1px solid #e6ebf2; background:#ffffff; border-top-left-radius:12px; border-top-right-radius:12px; }
  .controls-left{ display:flex; align-items:center; gap:10px; color:#64748b; font-size:0.95rem; }
  .controls-left select{ appearance:none; -webkit-appearance:none; -moz-appearance:none; padding:6px 10px; border:1px solid #e2e8f0; border-radius:8px; background:#fff; color:#0f172a; }
  .controls-right{ display:flex; align-items:center; gap:10px; color:#64748b; font-size:0.95rem; }
  .controls-right input{ padding:8px 10px; border:1px solid #e2e8f0; border-radius:8px; background:#fff; color:#0f172a; width:220px; }
  .table-footer{ display:flex; align-items:center; justify-content:space-between; gap:16px; padding:12px 16px; border-top:1px solid #e6ebf2; background:#ffffff; border-bottom-left-radius:12px; border-bottom-right-radius:12px; }
  /* Sort indicators for tables: show both arrows, highlight active */
  .th-sortable{ cursor:pointer; user-select:none; }
  .th-sortable .sort-icons{ display:inline-flex; flex-direction:column; margin-left:6px; line-height:0.8; vertical-align:middle; }
  .th-sortable .arrow{ font-size:0.65rem; color:#94a3b8; }
  thead th.sorted-asc .arrow.up{ color:#2563eb; }
  thead th.sorted-desc .arrow.down{ color:#2563eb; }
  </style>
</head>
<body>
  {% include 'partials/congreso_sidebar.html' %}

  <div class="main">
    {% include 'partials/congreso_topbar.html' %}

    {# Avisos solo para aprobaciones/rechazos realizados aquí #}
    {% if messages %}
      {% for m in messages %}
        {% if 'approval' in m.tags %}
          {# Mapear correctamente a clases de Bootstrap: success/info/warning/error #}
          <div class="alert {% if 'error' in m.tags %}alert-danger{% elif 'success' in m.tags %}alert-success{% elif 'warning' in m.tags %}alert-warning{% elif 'info' in m.tags %}alert-info{% else %}alert-secondary{% endif %} alert-dismissible fade show" role="alert" style="margin-top:16px;">
            {{ m }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <div class="hero">
      <h1>{{ congreso.name }}</h1>
    </div>

    <div class="welcome-card">
      <div class="wc-left">
  <div class="wc-title">¡Bienvenido de nuevo, {{ request.user.first_name|default:request.user.username }}!</div>
        <div class="wc-quote">“La educación no cambia al mundo: cambia a las personas que van a cambiar el mundo.”</div>
        <div class="text-end mt-3" style="color:#475569;">– Paulo Freire</div>
        <div class="mt-3">
          <a href="{% url 'instructores' congreso.id %}" class="btn wc-action btn-green">Administrar Instructores <i class="bi bi-arrow-right-short"></i></a>
        </div>
      </div>
      <div class="wc-right">
        {% if congreso.logo %}
          <div class="wc-logo"><img src="{{ congreso.logo.url }}" alt="Logo de {{ congreso.name }}" /></div>
        {% else %}
          <div class="wc-spacer" aria-hidden="true"></div>
        {% endif %}
      </div>
    </div>

    <div class="panel">
      <div class="panel-header d-flex align-items-center justify-content-between">
        <span class="panel-title-blue">Solicitudes pendientes</span>
        <span class="badge text-bg-primary">{{ pending_memberships|length }}</span>
      </div>
      <div class="panel-body">
        {% if pending_memberships %}
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Usuario</th>
                  <th>Nombre</th>
                  <th>Rol</th>
                  <th>Fecha</th>
                  <th class="text-end">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for m in pending_memberships %}
                  <tr>
                    <td style="white-space:nowrap;">{{ m.user.username }}</td>
                    <td>{{ m.user|full_name }}</td>
                    <td class="text-capitalize">{{ m.role }}</td>
                    <td>{{ m.created_at|date:"Y-m-d H:i" }}</td>
                    <td class="text-end" style="white-space:nowrap;">
                      {% if is_admin %}
                      <form method="post" style="display:inline-block; margin-right:6px;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="approve_membership" />
                        <input type="hidden" name="membership_id" value="{{ m.id }}" />
                        <button type="submit" class="btn btn-sm btn-success"><i class="bi bi-check-lg"></i></button>
                      </form>
                      <form method="post" style="display:inline-block;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="reject_membership" />
                        <input type="hidden" name="membership_id" value="{{ m.id }}" />
                        <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-x-lg"></i></button>
                      </form>
                      {% else %}
                        <span class="text-muted">Sin permisos</span>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="empty">Aún no hay solicitudes en espera para este evento y congreso.</div>
        {% endif %}
      </div>
    </div>

    {% include 'partials/footer.html' %}
  </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</html>
