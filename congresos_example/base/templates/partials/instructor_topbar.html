<style>
.topbar{ position:sticky; top:0; z-index:1000; display:flex; align-items:center; justify-content:space-between; background:#ffffff; padding:8px 20px; border-bottom:1px solid #e6ebf2; min-height:52px; margin-left:-40px; margin-right:-40px; width:calc(100% + 80px); box-shadow:0 10px 18px -14px rgba(15,23,42,0.22); transition: box-shadow .25s ease, backdrop-filter .25s ease, background-color .25s ease; }
.topbar.scrolled{ box-shadow:0 4px 24px -4px rgba(15,23,42,0.28); backdrop-filter:saturate(180%) blur(6px); background:rgba(255,255,255,0.92); }
.topbar::before{ content:""; position:absolute; left:0; top:0; bottom:0; width:26px; background: linear-gradient(to right, rgba(15,23,42,0.10) 0%, rgba(15,23,42,0.06) 35%, rgba(15,23,42,0.00) 100%); pointer-events:none; }
.topbar::after{ content:""; position:absolute; left:0; right:0; bottom:-12px; height:12px; background: linear-gradient(to bottom, rgba(15,23,42,0.08), rgba(15,23,42,0.00)); pointer-events:none; }
.topbar-left{ display:flex; align-items:center; gap:16px; }
.icon-btn{ display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:999px; border:1px solid #e6ebf2; background:#fff; color:#64748b; cursor:pointer; box-shadow:0 1px 2px rgba(16,24,40,.05); transition: background .12s ease, box-shadow .12s ease, color .12s ease; pointer-events:auto; }
.icon-btn svg{ width:18px; height:18px; }
.icon-btn:hover{ background:#f7fafc; color:#0f172a; box-shadow:0 2px 6px rgba(16,24,40,.08); }
.icon-btn.user{ width:44px; height:44px; }
.user-menu{ position:fixed; top:64px; right:24px; width:280px; background:#ffffff; border:1px solid #e6ebf2; border-radius:12px; box-shadow:0 18px 44px rgba(15,23,42,0.18); display:none; z-index:50; overflow:hidden; }
.user-menu.open{ display:block; }
.user-menu .um-header{ display:flex; align-items:center; gap:12px; padding:12px 16px; font-weight:700; color:#0b1730; background:#f8fafc; border-bottom:1px solid #e6ebf2; }
.user-menu .um-header .avatar{ width:34px; height:34px; display:inline-flex; align-items:center; justify-content:center; border-radius:999px; border:1px solid #e6ebf2; color:#64748b; }
.user-menu .um-list a{ display:flex; align-items:center; gap:10px; padding:12px 16px; color:#334155; text-decoration:none; background:#fff; }
.user-menu .um-list a:hover{ background:#eef5ff; color:#0b5ed7; }
.user-menu .um-list a .bi{ color:#64748b; }

/* Overlay para móvil cuando el sidebar está abierto */
.sidebar-overlay{ position:fixed; inset:0; background:rgba(15,23,42,0.35); backdrop-filter:blur(2px); opacity:0; visibility:hidden; transition:opacity .28s ease, visibility .28s ease; z-index:950; }
body.sidebar-open .sidebar-overlay{ opacity:1; visibility:visible; }
</style>
<div class="topbar">
	<div class="topbar-left">
		<button id="btnBurger" class="icon-btn" aria-label="Abrir menú" title="Menú">
			<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<line x1="3" y1="6" x2="21" y2="6"/>
				<line x1="3" y1="12" x2="21" y2="12"/>
				<line x1="3" y1="18" x2="21" y2="18"/>
			</svg>
		</button>
	</div>
	<button id="btnUser" class="icon-btn user" aria-label="Usuario" title="Usuario">
		<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
			<circle cx="12" cy="7" r="4"/>
		</svg>
	</button>
</div>
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<div id="userMenu" class="user-menu" aria-hidden="true">
	<div class="um-header">
		<span class="avatar"><i class="bi bi-person"></i></span>
		<span>
			Instructor<br>
			<small style="font-weight:500; color:#64748b;">{{ congreso.name|default:"Sin congreso" }}</small>
		</span>
	</div>
	<div class="um-list">
		<a href="{% url 'instructor_perfil' %}"><i class="bi bi-gear"></i> <span>Modificar Perfil</span></a>
		<a href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i> <span>Salir</span></a>
	</div>
</div>
<script>
	(function(){
		var userBtn = document.getElementById('btnUser');
		var userMenu = document.getElementById('userMenu');
		var burger = document.getElementById('btnBurger');
		var overlay = document.getElementById('sidebarOverlay');
		var topbar = document.querySelector('.topbar');

		function closeUserMenu(){ if(userMenu) userMenu.classList.remove('open'); }
		function applyScrollState(){ if(topbar){ topbar.classList.toggle('scrolled', window.scrollY > 4); } }
		function syncMobileState(){
			if(window.innerWidth <= 992){
				// overlay visible solo cuando sidebar está expandido
				document.body.classList.toggle('sidebar-open', !document.body.classList.contains('sidebar-collapsed'));
			}else{
				document.body.classList.remove('sidebar-open');
			}
		}

		if(userBtn && userMenu){
			userBtn.addEventListener('click', function(e){ e.stopPropagation(); userMenu.classList.toggle('open'); });
			document.addEventListener('click', function(){ closeUserMenu(); });
			document.addEventListener('keydown', function(ev){ if(ev.key === 'Escape') closeUserMenu(); });
			userMenu.addEventListener('click', function(e){ e.stopPropagation(); });
		}
		if(burger){
			burger.addEventListener('click', function(){
				document.body.classList.toggle('sidebar-collapsed');
				try{ localStorage.setItem('ins_sidebar_collapsed', document.body.classList.contains('sidebar-collapsed') ? '1':'0'); }catch(e){}
				syncMobileState();
			});
			var collapsed = localStorage.getItem('ins_sidebar_collapsed') === '1';
			if(collapsed){ document.body.classList.add('sidebar-collapsed'); }
		}
		if(overlay){
			overlay.addEventListener('click', function(){
				document.body.classList.add('sidebar-collapsed');
				syncMobileState();
			});
		}
		window.addEventListener('resize', syncMobileState);
		window.addEventListener('scroll', applyScrollState, { passive:true });
		applyScrollState();
		syncMobileState();
	})();
</script>