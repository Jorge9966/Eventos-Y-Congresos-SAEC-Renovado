<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Perfil del Instructor</title>
  {% load static %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  {% include '_congreso_base_styles.html' %}
  <style>
    /* Ajustes específicos del perfil (mantener paleta de inicio_instructor) */
  /* Fondo aún más oscuro para más contraste, igual que en inicio */
  body { background:#cbd5e1; }
  .main { background:#e2e8f0; }
    .hero-banner { margin-left:-40px; margin-right:-40px; width:calc(100% + 80px); background: linear-gradient(90deg, #1d4ed8 0%, #3b82f6 50%, #5b21b6 100%); color:#fff; min-height:200px; display:flex; align-items:center; padding:28px 40px; }
    .hero-banner h1 { font-weight:600; font-size:2rem; margin:0; }
    .card-panel{ background:#f7f9fc; border:1px solid #e6ebf2; border-radius:12px; box-shadow: 0 10px 28px rgba(15,23,42,0.06); overflow:hidden; margin-top:24px; }
    .card-header{ background:#f1f5f9; padding:14px 18px; color:#0b1730; font-weight:700; border-bottom:1px solid #e6ebf2; }
    .card-body{ padding:18px; background:#ffffff; }
    .form-label{ color:#334155; font-weight:500; }
    .btn-primary{ background:#1d4ed8; border:none; border-radius:10px; padding:10px 18px; }
    .btn-primary:hover{ background:#1e40af; }
    .input-append{ display:flex; align-items:stretch; }
    .input-append .form-control{ border-top-right-radius:0; border-bottom-right-radius:0; border-right:0; }
    .input-append .append-btn{ display:flex; align-items:center; justify-content:center; padding:0 16px; background:#0d6efd; color:#fff; border:1px solid #0d6efd; border-top-left-radius:0; border-bottom-left-radius:0; border-top-right-radius:10px; border-bottom-right-radius:10px; cursor:pointer; }
    .input-append .append-btn:hover{ background:#0b5ed7; border-color:#0b5ed7; }
    .toggle-visibility{ background:transparent; border:none; }
    .help-text{ color:#64748b; font-size:0.9rem; margin-top:8px; }
  </style>
</head>
<body>
  {% include 'partials/instructor_sidebar.html' %}
  <div class="main">
    {% include 'partials/instructor_topbar.html' %}

    <section class="hero-banner">
      <h1 class="page-title m-0">Perfil</h1>
    </section>

    <div class="container-fluid" style="padding-left:0; padding-right:0;">
      {# Mensajes globales si hiciera falta #}
      {% if messages %}
        <div class="mt-3">
          {% for message in messages %}
            {% if 'global' in message.tags %}
              <div class="alert {% if 'error' in message.tags %}alert-danger{% else %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      <!-- Card: Nombre y Apellidos -->
      <div class="card-panel" id="fullname">
        <div class="card-header">Nombre y apellidos</div>
        <div class="card-body">
          {% if messages %}
            {% for message in messages %}
              {% if 'fullname' in message.tags %}
                <div class="alert {% if 'error' in message.tags %}alert-danger{% else %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_fullname" />
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label" for="first_name">Nombre(s)</label>
                <input class="form-control" id="first_name" name="first_name" type="text" maxlength="150" value="{{ first_name_value|default:request.user.first_name }}" />
              </div>
              <div class="col-md-4">
                <label class="form-label" for="last_name_paterno">Apellido paterno</label>
                <input class="form-control" id="last_name_paterno" name="last_name_paterno" type="text" maxlength="150" value="{{ last_name_paterno_value }}" />
              </div>
              <div class="col-md-4">
                <label class="form-label" for="last_name_materno">Apellido materno</label>
                <input class="form-control" id="last_name_materno" name="last_name_materno" type="text" maxlength="150" value="{{ last_name_materno_value }}" />
              </div>
            </div>
            <button class="btn btn-primary mt-3" type="submit">Actualizar</button>
          </form>
        </div>
      </div>

      <!-- Card: Usuario (correo) -->
      <div class="card-panel" id="user">
        <div class="card-header">Usuario (correo electrónico)</div>
        <div class="card-body">
          {% if messages %}
            {% for message in messages %}
              {% if 'user' in message.tags %}
                <div class="alert {% if 'error' in message.tags %}alert-danger{% else %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_name" />
            <div class="mb-3">
              <label class="form-label" for="username">Correo</label>
              <input class="form-control" id="username" name="username" type="email" autocomplete="email" value="{{ username_value|default:request.user.username }}" required />
              {% if allowed_domains_profile %}
                <div class="help-text">Dominios permitidos: {{ allowed_domains_profile|join:", " }}.</div>
              {% endif %}
            </div>
            <button class="btn btn-primary" type="submit">Actualizar</button>
          </form>
        </div>
      </div>

      <!-- Card: Cambiar contraseña -->
      <div class="card-panel" id="password">
        <div class="card-header">Cambiar contraseña</div>
        <div class="card-body">
          {% if messages %}
            {% for message in messages %}
              {% if 'password' in message.tags %}
                <div class="alert {% if 'error' in message.tags %}alert-danger{% else %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
          <form method="post" id="passwordForm">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_password" />
            <div class="mb-3">
              <label class="form-label" for="current_password">Contraseña Actual</label>
              <div class="input-append">
                <input class="form-control" id="current_password" name="current_password" type="password" required />
                <button class="append-btn toggle-visibility" type="button" data-target="#current_password" title="Mostrar/Ocultar">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label" for="new_password">Nueva Contraseña</label>
              <div class="input-append">
                <input class="form-control" id="new_password" name="new_password" type="password" required minlength="8" maxlength="16" pattern="(?=.{8,16}$)(?=.*[A-Z])(?=.*[a-z])(?=.*[\.!%&\$\}]).+" title="8-16 caracteres, con al menos 1 mayúscula, 1 minúscula y 1 símbolo especial (.!%&$})" />
                <button class="append-btn toggle-visibility" type="button" data-target="#new_password" title="Mostrar/Ocultar">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              <div class="help-text">Debe tener 8-16 caracteres e incluir al menos 1 mayúscula, 1 minúscula y 1 símbolo especial (.!%&$}).</div>
            </div>
            <div class="mb-3">
              <label class="form-label" for="confirm_password">Confirmar Nueva Contraseña</label>
              <div class="input-append">
                <input class="form-control" id="confirm_password" name="confirm_password" type="password" required minlength="8" maxlength="16" pattern="(?=.{8,16}$)(?=.*[A-Z])(?=.*[a-z])(?=.*[\.!%&\$\}]).+" title="8-16 caracteres, con al menos 1 mayúscula, 1 minúscula y 1 símbolo especial (.!%&$})" />
                <button class="append-btn toggle-visibility" type="button" data-target="#confirm_password" title="Mostrar/Ocultar">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
            </div>
            <button class="btn btn-primary" type="submit">Actualizar</button>
          </form>
        </div>
      </div>

      {% include 'partials/footer.html' %}
    </div>
  </div>

  <script>
    (function(){
      // Toggle visibility para campos de contraseña
      document.querySelectorAll('.toggle-visibility').forEach(function(el){
        el.addEventListener('click', function(){
          var input = document.querySelector(el.getAttribute('data-target'));
          if(!input) return;
          if(input.type === 'password'){
            input.type = 'text'; el.innerHTML = '<i class="bi bi-eye"></i>';
          } else {
            input.type = 'password'; el.innerHTML = '<i class="bi bi-eye-slash"></i>';
          }
        });
      });
    })();
  </script>
</body>
</html>